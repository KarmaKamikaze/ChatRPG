@page "/Dashboard"
@using ChatRPG.Data

<h1>Dashboard</h1>

<div class="conversation">
    <div class="conversation-text">
        @foreach (string message in _conversation)
        {
            <p>@message</p>
        }
    </div>
</div>

<div class="user-prompt">
    <input type="text" @bind="_userInput" placeholder="What do you do?" @onkeyup="@EnterKeyHandler"/>
    <button @onclick="SendPrompt">Send</button>
</div>


@code {
    private readonly FileUtility _fileUtil = new FileUtility();
    readonly List<string> _conversation = new List<string>();
    string _userInput = "";

    async Task EnterKeyHandler(KeyboardEventArgs e)
    {
        if (e.Code is "Enter" or "NumpadEnter")
        {
            await SendPrompt();
        }
    }

    async Task SendPrompt()
    {
        if (!string.IsNullOrWhiteSpace(_userInput))
        {
            // Use the user input to generate a response
            string userMessage = $"You: {_userInput}";
            _conversation.Add(userMessage);
            await _fileUtil.UpdateSaveFileAsync(_userInput, true);
            string response = ProcessUserInput(_userInput);
            string gameMessage = $"Game: {response}";
            _conversation.Add(gameMessage);
            await _fileUtil.UpdateSaveFileAsync(response);

            // Clear the user input
            _userInput = "";

            // Notify the component to re-render because of async methods
            StateHasChanged();
        }
    }

    string ProcessUserInput(string input)
    {
        // Temporary response
        return "This is the game's response to your input.";
    }

}
